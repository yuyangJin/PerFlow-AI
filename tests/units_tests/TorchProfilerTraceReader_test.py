'''
test TorchProfilerTraceReader class
'''

from perflowai.reader import TorchProfilerTraceReader
from perflowai.core import EventType

output_str = '[<Event 1:forward_step-0-0>, <Event 2:forward_step-1-0>, <Event 3:forward_step-2-0>, <Event 4:forward_step-3-0>, <Event 5:forward_step-4-0>, <Event 6:forward_step-5-0>, <Event 7:forward_step-6-0>, <Event 8:forward_step-7-0>, <Event 9:forward_step-8-0>, <Event 10:forward_step-9-0>, <Event 11:forward_step-10-0>, <Event 12:forward_step-11-0>, <Event 13:forward_step-12-0>, <Event 14:forward_step-13-0>, <Event 15:forward_step-14-0>, <Event 16:forward_step-15-0>, <Event 17:forward_step-16-1>, <Event 18:forward_step-17-1>, <Event 19:forward_step-18-1>, <Event 20:forward_step-19-1>, <Event 21:forward_step-20-1>, <Event 22:forward_step-21-1>, <Event 23:forward_step-22-1>, <Event 24:forward_step-23-1>, <Event 25:forward_step-24-1>, <Event 26:forward_step-25-1>, <Event 27:forward_step-26-1>, <Event 28:forward_step-27-1>, <Event 29:forward_step-28-1>, <Event 30:forward_step-29-1>, <Event 31:forward_step-30-1>, <Event 32:forward_step-31-1>, <Event 33:forward_step-32-2>, <Event 34:forward_step-33-2>, <Event 35:forward_step-34-2>, <Event 36:forward_step-35-2>, <Event 37:forward_step-36-2>, <Event 38:forward_step-37-2>, <Event 39:forward_step-38-2>, <Event 40:forward_step-39-2>, <Event 41:forward_step-40-2>, <Event 42:forward_step-41-2>, <Event 43:forward_step-42-2>, <Event 44:forward_step-43-2>, <Event 45:forward_step-44-2>, <Event 46:forward_step-45-2>, <Event 47:forward_step-46-2>, <Event 48:forward_step-47-2>, <Event 49:forward_step-48-3>, <Event 50:forward_step-49-3>, <Event 51:forward_step-50-3>, <Event 52:forward_step-51-3>, <Event 53:forward_step-52-3>, <Event 54:forward_step-53-3>, <Event 55:forward_step-54-3>, <Event 56:forward_step-55-3>, <Event 57:forward_step-56-3>, <Event 58:forward_step-57-3>, <Event 59:forward_step-58-3>, <Event 60:forward_step-59-3>, <Event 61:forward_step-60-3>, <Event 62:forward_step-61-3>, <Event 63:forward_step-62-3>, <Event 64:forward_step-63-3>, <Event 65:forward_step-64-4>, <Event 66:forward_step-65-4>, <Event 67:forward_step-66-4>, <Event 68:forward_step-67-4>, <Event 69:forward_step-68-4>, <Event 70:forward_step-69-4>, <Event 71:forward_step-70-4>, <Event 72:forward_step-71-4>, <Event 73:forward_step-72-4>, <Event 74:forward_step-73-4>, <Event 75:forward_step-74-4>, <Event 76:forward_step-75-4>, <Event 77:forward_step-76-4>, <Event 78:forward_step-77-4>, <Event 79:forward_step-78-4>, <Event 80:forward_step-79-4>, <Event 81:forward_step-80-0>, <Event 82:forward_step-81-0>, <Event 83:forward_step-82-0>, <Event 84:forward_step-83-0>, <Event 85:forward_step-84-0>, <Event 86:forward_step-85-0>, <Event 87:forward_step-86-0>, <Event 88:forward_step-87-0>, <Event 89:forward_step-88-0>, <Event 90:forward_step-89-0>, <Event 91:forward_step-90-0>, <Event 92:forward_step-91-0>, <Event 93:forward_step-92-0>, <Event 94:forward_step-93-0>, <Event 95:forward_step-94-0>, <Event 96:backward_step-0-4>, <Event 103:forward_step-95-0>, <Event 104:backward_step-1-4>, <Event 111:forward_step-96-1>, <Event 112:backward_step-2-4>, <Event 119:forward_step-97-1>, <Event 120:backward_step-3-4>, <Event 127:forward_step-98-1>, <Event 128:backward_step-4-4>, <Event 135:forward_step-99-1>, <Event 136:backward_step-5-4>, <Event 143:forward_step-100-1>, <Event 144:backward_step-6-4>, <Event 151:forward_step-101-1>, <Event 152:backward_step-7-4>, <Event 159:forward_step-102-1>, <Event 160:backward_step-8-4>, <Event 167:forward_step-103-1>, <Event 168:backward_step-9-4>, <Event 175:forward_step-104-1>, <Event 176:backward_step-10-4>, <Event 183:forward_step-105-1>, <Event 184:backward_step-11-4>, <Event 191:forward_step-106-1>, <Event 192:backward_step-12-4>, <Event 199:forward_step-107-1>, <Event 200:backward_step-13-4>, <Event 207:forward_step-108-1>, <Event 208:backward_step-14-4>, <Event 215:forward_step-109-1>, <Event 216:backward_step-15-4>, <Event 223:forward_step-110-1>, <Event 224:backward_step-16-3>, <Event 231:forward_step-111-1>, <Event 232:backward_step-17-3>, <Event 239:forward_step-112-2>, <Event 240:backward_step-18-3>, <Event 247:forward_step-113-2>, <Event 248:backward_step-19-3>, <Event 255:forward_step-114-2>, <Event 256:backward_step-20-3>, <Event 263:forward_step-115-2>, <Event 264:backward_step-21-3>, <Event 271:forward_step-116-2>, <Event 272:backward_step-22-3>, <Event 279:forward_step-117-2>, <Event 280:backward_step-23-3>, <Event 287:forward_step-118-2>, <Event 288:backward_step-24-3>, <Event 295:forward_step-119-2>, <Event 296:backward_step-25-3>, <Event 303:forward_step-120-2>, <Event 304:backward_step-26-3>, <Event 311:forward_step-121-2>, <Event 312:backward_step-27-3>, <Event 319:forward_step-122-2>, <Event 320:backward_step-28-3>, <Event 327:forward_step-123-2>, <Event 328:backward_step-29-3>, <Event 335:forward_step-124-2>, <Event 336:backward_step-30-3>, <Event 343:forward_step-125-2>, <Event 344:backward_step-31-3>, <Event 351:forward_step-126-2>, <Event 352:backward_step-32-2>, <Event 359:forward_step-127-2>, <Event 360:backward_step-33-2>, <Event 367:forward_step-128-3>, <Event 368:backward_step-34-2>, <Event 375:forward_step-129-3>, <Event 376:backward_step-35-2>, <Event 383:forward_step-130-3>, <Event 384:backward_step-36-2>, <Event 391:forward_step-131-3>, <Event 392:backward_step-37-2>, <Event 399:forward_step-132-3>, <Event 400:backward_step-38-2>, <Event 407:forward_step-133-3>, <Event 408:backward_step-39-2>, <Event 415:forward_step-134-3>, <Event 416:backward_step-40-2>, <Event 423:forward_step-135-3>, <Event 424:backward_step-41-2>, <Event 431:forward_step-136-3>, <Event 432:backward_step-42-2>, <Event 439:forward_step-137-3>, <Event 440:backward_step-43-2>, <Event 447:forward_step-138-3>, <Event 448:backward_step-44-2>, <Event 455:forward_step-139-3>, <Event 456:backward_step-45-2>, <Event 463:forward_step-140-3>, <Event 464:backward_step-46-2>, <Event 471:forward_step-141-3>, <Event 472:backward_step-47-2>, <Event 479:forward_step-142-3>, <Event 480:backward_step-48-1>, <Event 487:forward_step-143-3>, <Event 488:backward_step-49-1>, <Event 495:forward_step-144-4>, <Event 496:backward_step-50-1>, <Event 503:forward_step-145-4>, <Event 504:backward_step-51-1>, <Event 511:forward_step-146-4>, <Event 512:backward_step-52-1>, <Event 519:forward_step-147-4>, <Event 520:backward_step-53-1>, <Event 527:forward_step-148-4>, <Event 528:backward_step-54-1>, <Event 535:forward_step-149-4>, <Event 536:backward_step-55-1>, <Event 543:forward_step-150-4>, <Event 544:backward_step-56-1>, <Event 551:forward_step-151-4>, <Event 552:backward_step-57-1>, <Event 559:forward_step-152-4>, <Event 560:backward_step-58-1>, <Event 567:forward_step-153-4>, <Event 568:backward_step-59-1>, <Event 575:forward_step-154-4>, <Event 576:backward_step-60-1>, <Event 583:forward_step-155-4>, <Event 584:backward_step-61-1>, <Event 591:forward_step-156-4>, <Event 592:backward_step-62-1>, <Event 599:forward_step-157-4>, <Event 600:backward_step-63-1>, <Event 607:forward_step-158-4>, <Event 608:backward_step-64-0>, <Event 615:forward_step-159-4>, <Event 616:backward_step-65-0>, <Event 623:backward_step-66-0>, <Event 630:backward_step-67-0>, <Event 637:backward_step-68-0>, <Event 644:backward_step-69-0>, <Event 651:backward_step-70-0>, <Event 658:backward_step-71-0>, <Event 665:backward_step-72-0>, <Event 672:backward_step-73-0>, <Event 679:backward_step-74-0>, <Event 686:backward_step-75-0>, <Event 693:backward_step-76-0>, <Event 700:backward_step-77-0>, <Event 707:backward_step-78-0>, <Event 714:backward_step-79-0>, <Event 721:backward_step-80-4>, <Event 728:backward_step-81-4>, <Event 735:backward_step-82-4>, <Event 742:backward_step-83-4>, <Event 749:backward_step-84-4>, <Event 756:backward_step-85-4>, <Event 763:backward_step-86-4>, <Event 770:backward_step-87-4>, <Event 777:backward_step-88-4>, <Event 784:backward_step-89-4>, <Event 791:backward_step-90-4>, <Event 798:backward_step-91-4>, <Event 805:backward_step-92-4>, <Event 812:backward_step-93-4>, <Event 819:backward_step-94-4>, <Event 826:backward_step-95-4>, <Event 833:backward_step-96-3>, <Event 840:backward_step-97-3>, <Event 847:backward_step-98-3>, <Event 854:backward_step-99-3>, <Event 861:backward_step-100-3>, <Event 868:backward_step-101-3>, <Event 875:backward_step-102-3>, <Event 882:backward_step-103-3>, <Event 889:backward_step-104-3>, <Event 896:backward_step-105-3>, <Event 903:backward_step-106-3>, <Event 910:backward_step-107-3>, <Event 917:backward_step-108-3>, <Event 924:backward_step-109-3>, <Event 931:backward_step-110-3>, <Event 938:backward_step-111-3>, <Event 945:backward_step-112-2>, <Event 952:backward_step-113-2>, <Event 959:backward_step-114-2>, <Event 966:backward_step-115-2>, <Event 973:backward_step-116-2>, <Event 980:backward_step-117-2>, <Event 987:backward_step-118-2>, <Event 994:backward_step-119-2>, <Event 1001:backward_step-120-2>, <Event 1008:backward_step-121-2>, <Event 1015:backward_step-122-2>, <Event 1022:backward_step-123-2>, <Event 1029:backward_step-124-2>, <Event 1036:backward_step-125-2>, <Event 1043:backward_step-126-2>, <Event 1050:backward_step-127-2>, <Event 1057:backward_step-128-1>, <Event 1058:backward_step-129-1>, <Event 1059:backward_step-130-1>, <Event 1060:backward_step-131-1>, <Event 1061:backward_step-132-1>, <Event 1062:backward_step-133-1>, <Event 1063:backward_step-134-1>, <Event 1064:backward_step-135-1>, <Event 1065:backward_step-136-1>, <Event 1066:backward_step-137-1>, <Event 1067:backward_step-138-1>, <Event 1068:backward_step-139-1>, <Event 1069:backward_step-140-1>, <Event 1070:backward_step-141-1>, <Event 1071:backward_step-142-1>, <Event 1072:backward_step-143-1>, <Event 1073:backward_step-144-0>, <Event 1074:backward_step-145-0>, <Event 1075:backward_step-146-0>, <Event 1076:backward_step-147-0>, <Event 1077:backward_step-148-0>, <Event 1078:backward_step-149-0>, <Event 1079:backward_step-150-0>, <Event 1080:backward_step-151-0>, <Event 1081:backward_step-152-0>, <Event 1082:backward_step-153-0>, <Event 1083:backward_step-154-0>, <Event 1084:backward_step-155-0>, <Event 1085:backward_step-156-0>, <Event 1086:backward_step-157-0>, <Event 1087:backward_step-158-0>, <Event 1088:backward_step-159-0>]'

def test_TorchProfilerTraceReader():
    tp_reader = TorchProfilerTraceReader('./tests/example_trace/out-1024.json')
    tp_reader.read([EventType.FWD, EventType.BWD])
    output = tp_reader.get_outputs()
    assert len(output) == 1
    trace = output[0]
    assert trace.get_ndevs() == 1024
    events = trace.get_events(0)
    print(len(events))
    assert len(events) == 320
    assert str(events) == output_str